package session;

import java.util.concurrent.atomic.AtomicInteger;

import jakarta.servlet.ServletContext;
import jakarta.servlet.annotation.WebListener;
import jakarta.servlet.http.HttpSessionEvent;
import jakarta.servlet.http.HttpSessionListener;

@WebListener
public class SessionListener implements HttpSessionListener{

	// 세션이 생성될 때 실행
	@Override
	public void sessionCreated(HttpSessionEvent se) {
		System.out.println("세션 생성...");
	}

	// 세션이 종료될 때 실행
	@Override
	public void sessionDestroyed(HttpSessionEvent se) {
		// 세션 종료시 application 객체에서 접속자 수를 감소
		ServletContext application = se.getSession().getServletContext();
		AtomicInteger visitorCount = (AtomicInteger) application.getAttribute("visitorCount");
		int count = 0;
		if(visitorCount != null) {
			count = visitorCount.decrementAndGet();
			System.out.println("접속자 수 -1");
		}
		System.out.println("접속자 수? "+ count);
	}
}